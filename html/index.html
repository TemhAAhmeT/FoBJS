<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- https://electronjs.org/docs/tutorial/security#csp-meta-tag -->
    <link rel="stylesheet" href="../css/index.css">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
    <script src="../js/console.js"></script>
</head>

<body>
    <div id="information" class="console">
        ###Display###
    </div>
    <div id="loadingOverlay" style="display: none;" class="loading style-2"><div class="loading-wheel"></div><div id="loadingText" class="loading-text"></div></div>
</body>

<script>
    var info = document.querySelector('div#information');
    var { ipcRenderer } = require('electron');

    function openTab(xtab) {

        //debugger;
        if (document.getElementById(xtab) === undefined) return;
        var i = 0, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].className = tabcontent[i].className.replace(" active", "");
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(xtab).style.display = "block";
        document.getElementById(xtab).className += " active"
        document.getElementById("btn" + xtab).className += " active";
        ipcRenderer.send('setActiveTab', xtab);
    }

    function loadEventHandler() {
        document.querySelectorAll('.rFFL').forEach(item => {
            item.style.cursor = "pointer";
            item.addEventListener('click', event => {
                toggleOverlay([true,"Removing Friend..."]);
                ipcRenderer.send('removeFriend', event.target.dataset["playerid"]);
            })
        });
        document.querySelector('.CollectTavern').addEventListener('click', event => {
            toggleOverlay([true,"Collect Tavern..."]);
            ipcRenderer.send('collectTavern', "");
        });
        document.querySelector('.StartProduction').addEventListener('click', event => {
            toggleOverlay([true,"Start Production..."]);
            ipcRenderer.send('startProduction', "");
        });
        document.querySelector('.CollectProduction').addEventListener('click', event => {
            toggleOverlay([true,"Collect Production..."]);
            ipcRenderer.send('collectProduction', "");
        });
        document.querySelector('.CancelProduction').addEventListener('click', event => {
            toggleOverlay([true,"Cancel Production..."]);
            ipcRenderer.send('cancelProduction', "");
        });
        document.querySelector('.CollectIncidents').addEventListener('click', event => {
            toggleOverlay([true,"Collect Incidents..."]);
            ipcRenderer.send('collectIncidents', "");
        });
        document.querySelector('.CollectTavern').style.cursor = "pointer";
        document.querySelector('.StartProduction').style.cursor = "pointer";
        document.querySelector('.CollectProduction').style.cursor = "pointer";
        document.querySelector('.CancelProduction').style.cursor = "pointer";
        document.querySelector('.CollectIncidents').style.cursor = "pointer";
    }

    function init(tabName) {
        if (tabName != null && typeof (tabName) !== "object") {
            openTab(tabName);
        } else {
            document.getElementById("btnOverview").click();
        }
    }

    ipcRenderer.on('information', (e, data) => {
        info.innerHTML = data;
    });
    ipcRenderer.on('clearInfoMenu', (e, data) => {
        info.innerHTML = "";
    });
    ipcRenderer.on('updateElement', (e, data) => {
        if (document.getElementById(data[0]) !== null) {
            document.getElementById(data[0]).innerHTML = data[1];
        }
    });
    ipcRenderer.on('toggleOverlay', (e, data) => {
        toggleOverlay(data);
    });

    function toggleOverlay(data){
        if (data[0] == false) {
            document.getElementById("loadingOverlay").style.display = "none";
        }else{
            document.getElementById("loadingOverlay").style.display = "block";
            document.getElementById("loadingText").innerText = data[1];
        }
    }

    ipcRenderer.send('windowLoaded', "");
    ipcRenderer.on('toggleTab', (e, data) => {
        setTimeout(()=>{
            openTab(data);
        }, 1000);
    });
</script>

</html>