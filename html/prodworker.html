<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title></title>
  <script src="../js/timer.js"></script>
</head>

<body>
  <script>
    const electron = require('electron');
    const ipcRenderer = electron.ipcRenderer;

    const FoBCore = require('../module/FoBCore');

    var IntervallID = null;
    var ProdDict = [];
    var ResDict = [];
    const eState = { Producing: 1, Idle: 2, Finished: 3 };

    ipcRenderer.send('worker_loaded', true);

    ipcRenderer.on('start', (e, d) => {
      ProdDict = d.ProdDict;
      ResDict = d.ResDict;
      startWorker();
    });

    ipcRenderer.on('updateProdDict', (e, d) => {
      ProdDict = d.ProdDict;
      ResDict = d.ResDict
      if(!d.isAuto)
        DoWorker(false);
    });

    ipcRenderer.on('stop', () => {
      if (IntervallID !== null) {
        timer.stop();
      }
    });

    function startWorker() {
      if (IntervallID === null) {

        IntervallID = setInterval(()=>{
          DoWorker();
        },(1000*62*5));

        DoWorker();
        IntervallID = timer.timeout;
      }
    }

    function DoWorker(isAuto = true) {
          ipcRenderer.send('DoWork', {ProdDict,ResDict,isAuto});
    }

  </script>
</body>

</html>